<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emason Hub</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="logo">
            <img src="images/logo.png" alt="Emason Hub Logo">
        </div>
        <nav>
            <ul>
                <li><a href="#home">HOME</a></li>
                <li><a href="#catalog">SHOP BY CATEGORY</a></li>
                <li>
                    <button class="cart-button" onclick="location.href='#cart'">
                        <img src="images/cart.png" alt="Cart">
                        CART (<span id="cart-count">0</span>)
                    </button>
                </li>
            </ul>
        </nav>
    </header>
    
    <section id="home" class="hero">
        <img src="images/imageTOP.jpg" alt="Curtains Display">
        <div class="hero-text">
            <h1>EMASON HUB</h1>
            <p>Bring home interiors at your doorstep</p>
            <button onclick="location.href='#catalog'">SHOP NOW</button>
        </div>
    </section>

    <section id="catalog" class="catalog">
        <h2 class="section-title">Shop by Category</h2>
        <div class="categories">
            <button onclick="showCategory('curtains')">Curtains</button>
            <button onclick="showCategory('wallpapers')">Wallpapers</button>
            <button onclick="showCategory('windowblinds')">Window Blinds</button>
        </div>
    </section>

    <div id="products-container"></div>

    <section id="cart" class="cart">
        <h2 class="section-title">Your Cart</h2>
        <div id="cart-items"></div>
        <button class="place-order-button" onclick="placeOrder()">PLACE ORDER</button>
    </section>
    
    <section class="testimonials">
        <h2>Testimonials</h2>
        <div class="testimonial">
            <p>"Emason Hub has transformed my living room with their beautiful curtains. The quality is top-notch and the service was excellent. Highly recommend!"</p>
            <p>- Chinedu Okafor</p>
        </div>
        <div class="testimonial">
            <p>"I am extremely satisfied with the wallpapers I purchased from Emason Hub. They have a wide variety of designs and the installation was seamless. Great job!"</p>
            <p>- Aisha Bello</p>
        </div>
        <div class="testimonial">
            <p>"The window blinds I got from Emason Hub are perfect. They add a touch of elegance to my office. The customer service was also very helpful and responsive."</p>
            <p>- Tunde Adeyemi</p>
        </div>
        <img src="images/logo.png" alt="Emason Hub Logo" class="testimonials-img">
    </section>
    
    <footer>
        <p>Contact us: <a href="mailto:emasonhub@gmail.com">info@emasonhub.com</a></p>
        <p>Follow us on Instagram: <a href="https://www.instagram.com/emason_curtainhub?igsh=MTJrZm9xMjEzcWV2Nw==" target="_blank" rel="noopener">@emasonhub</a></p>
        <p>&copy; 2025. All Rights Reserved.</p>
    </footer>

    <button class="back-to-top" onclick="scrollToTop()">↑</button>

    <!-- Modal Structure -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img id="modalImage" src="" alt="Product Image">
            <div class="thumbnail-container">
                <img class="thumbnail" id="thumb1" src="" onclick="showImage(0)" title="Thumbnail 1">
                <img class="thumbnail" id="thumb2" src="" onclick="showImage(1)" title="Thumbnail 2">
                <img class="thumbnail" id="thumb3" src="" onclick="showImage(2)" title="Thumbnail 3">
            </div>
        </div>
    </div>

    <!-- User Registration Form -->
    <section id="register" class="register">
        <h2>Register</h2>
        <form id="registerForm">
            <input type="text" id="username" placeholder="Username" required>
            <input type="email" id="email" placeholder="Email" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit">Register</button>
        </form>
    </section>

    <!-- User Login Form -->
    <section id="login" class="login">
        <h2>Login</h2>
        <form id="loginForm">
            <input type="email" id="loginEmail" placeholder="Email" required>
            <input type="password" id="loginPassword" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>
    </section>

    <!-- Checkout Page -->
    <section id="checkout" class="checkout hidden">
        <h2>Checkout</h2>
        <form id="checkoutForm">
            <h3>Shipping Details</h3>
            <input type="text" id="shippingName" placeholder="Full Name" required>
            <input type="text" id="shippingAddress" placeholder="Address" required>
            <input type="text" id="shippingCity" placeholder="City" required>
            <input type="text" id="shippingState" placeholder="State" required>
            <input type="text" id="shippingZip" placeholder="Zip Code" required>
            <input type="text" id="shippingCountry" placeholder="Country" required>

            <h3>Billing Details</h3>
            <input type="text" id="billingName" placeholder="Full Name" required>
            <input type="text" id="billingAddress" placeholder="Address" required>
            <input type="text" id="billingCity" placeholder="City" required>
            <input type="text" id="billingState" placeholder="State" required>
            <input type="text" id="billingZip" placeholder="Zip Code" required>
            <input type="text" id="billingCountry" placeholder="Country" required>

            <h3>Payment Details</h3>
            <div id="card-element"></div> <!-- Stripe Elements will be inserted here -->

            <button type="submit">Pay Now</button>
        </form>
    </section>

    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <script>
        const cart = [];

        function updatePrice(sizeId, quantityId, priceId, productId) {
            const size = document.getElementById(sizeId).value;
            const quantity = document.getElementById(quantityId).value;
            const price = productPrices[productId][size] * quantity;
            document.getElementById(priceId).innerText = `₦${price}`;
        }

        function changeQuantity(quantityId, delta) {
            const quantityInput = document.getElementById(quantityId);
            let quantity = parseInt(quantityInput.value);
            quantity = Math.max(1, Math.min(9, quantity + delta));
            quantityInput.value = quantity;
            const sizeId = quantityId.replace('quantity', 'size');
            const priceId = quantityId.replace('quantity', 'price');
            const productId = quantityId.replace('quantity', 'product');
            updatePrice(sizeId, quantityId, priceId, productId);
        }

        function addToCart(name, color, sizeId, quantityId, priceId) {
            const size = document.getElementById(sizeId).value;
            const quantity = document.getElementById(quantityId).value;
            const price = document.getElementById(priceId).innerText;
            cart.push({ name, color, size, quantity, price });
            updateCartCount();
            displayCartItems();
        }

        function updateCartCount() {
            document.getElementById('cart-count').innerText = cart.length;
        }

        function displayCartItems() {
            const cartItems = document.getElementById('cart-items');
            cartItems.innerHTML = '';
            cart.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'cart-item';
                itemDiv.innerHTML = `
                    <p>${item.name} - ${item.color} - ${item.size} - Quantity: ${item.quantity} - ${item.price}</p>
                    <button onclick="removeFromCart(${index})">REMOVE</button>
                `;
                cartItems.appendChild(itemDiv);
            });
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartCount();
            displayCartItems();
        }

        function placeOrder() {
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            document.getElementById('checkout').classList.remove('hidden');
            document.getElementById('cart').classList.add('hidden');
        }

        document.getElementById('checkoutForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const shippingDetails = {
                name: document.getElementById('shippingName').value,
                address: document.getElementById('shippingAddress').value,
                city: document.getElementById('shippingCity').value,
                state: document.getElementById('shippingState').value,
                zip: document.getElementById('shippingZip').value,
                country: document.getElementById('shippingCountry').value
            };
            const billingDetails = {
                name: document.getElementById('billingName').value,
                address: document.getElementById('billingAddress').value,
                city: document.getElementById('billingCity').value,
                state: document.getElementById('billingState').value,
                zip: document.getElementById('billingZip').value,
                country: document.getElementById('billingCountry').value
            };
            const amount = calculateTotalAmount(); // Implement this function to calculate the total amount
            const email = 'customer@example.com'; // Replace with the customer's email

            try {
                const response = await fetch('/payments/create-payment-intent', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount, email, items: cart, shippingDetails, billingDetails })
                });
                const result = await response.json();
                if (!response.ok) throw new Error(result.error || 'Failed to create payment intent');

                // Redirect to Paystack payment page
                const handler = PaystackPop.setup({
                    key: 'your_paystack_public_key', // Replace with your Paystack public key
                    email: email,
                    amount: amount * 100, // Amount in kobo
                    currency: 'NGN',
                    ref: result.reference, // Use the reference from the backend
                    callback: function(response) {
                        // Payment was successful
                        window.location.href = `/payments/verify-payment?reference=${response.reference}`;
                    },
                    onClose: function() {
                        alert('Payment cancelled');
                    }
                });
                handler.openIframe();
            } catch (error) {
                alert(error.message);
            }
        });

        let currentImageIndex = 0;
        let currentImages = [];

        function openModal(images) {
            currentImages = images;
            currentImageIndex = 0;
            showImage(currentImageIndex);
            const modal = document.getElementById('imageModal');
            modal.style.display = 'block';
            document.getElementById('thumb1').src = images[0];
            document.getElementById('thumb2').src = images[1];
            document.getElementById('thumb3').src = images[2];
        }

        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
        }

        function showImage(index) {
            currentImageIndex = index;
            const modalImage = document.getElementById('modalImage');
            modalImage.src = currentImages[index];
            document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
                thumb.classList.toggle('active', i === index);
            });
        }

        document.querySelector('.close').onclick = closeModal;

        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        async function loadProducts() {
            try {
                const response = await fetch('products.json');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const products = await response.json();
                const container = document.getElementById('products-container');

                for (const category in products) {
                    const section = document.createElement('section');
                    section.id = category;
                    section.className = 'products hidden';
                    section.innerHTML = `<h3 class="section-subtitle">${category.charAt(0).toUpperCase() + category.slice(1)}</h3>`;

                    products[category].forEach((product, index) => {
                        const productDiv = document.createElement('div');
                        productDiv.className = 'product';
                        productDiv.innerHTML = `
                            <img src="${product.image}" alt="${product.name}" onclick="openModal(['${product.image}', '${product.image2}', '${product.image3}'])">
                            <div class="product-details">
                                <h3>${product.name}</h3>
                                <p>Color - ${product.color}</p>
                                <p>
                                    <label for="size${category}${index}">Size:</label>
                                    <select id="size${category}${index}" name="size${category}${index}" onchange="updatePrice('size${category}${index}', 'quantity${category}${index}', 'price${category}${index}', '${category}${index}')">
                                        ${Object.keys(product.sizes).map(size => `<option value="${size}">${size.charAt(0).toUpperCase() + size.slice(1)}</option>`).join('')}
                                    </select>
                                </p>
                                <p>
                                    <label for="quantity${category}${index}">Quantity:</label>
                                    <div class="quantity-controls">
                                        <button type="button" onclick="changeQuantity('quantity${category}${index}', -1)">-</button>
                                        <input type="number" id="quantity${category}${index}" name="quantity${category}${index}" value="1" min="1" max="9" readonly>
                                        <button type="button" onclick="changeQuantity('quantity${category}${index}', 1)">+</button>
                                    </div>
                                </p>
                                <p>Price: <span id="price${category}${index}">₦${product.sizes.small}</span></p>
                                <button onclick="addToCart('${product.name}', '${product.color}', 'size${category}${index}', 'quantity${category}${index}', 'price${category}${index}')">ADD TO CART</button>
                            </div>
                        `;
                        section.appendChild(productDiv);
                    });

                    container.appendChild(section);
                }
            } catch (error) {
                console.error('Failed to load products:', error);
            }
        }

        loadProducts();

        window.onscroll = function() {
            const backToTopButton = document.querySelector('.back-to-top');
            if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                backToTopButton.style.display = 'block';
            } else {
                backToTopButton.style.display = 'none';
            }
        };

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            try {
                const response = await fetch('/users/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });
                if (!response.ok) throw new Error('Registration failed');
                alert('Registration successful!');
            } catch (error) {
                alert(error.message);
            }
        });

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            try {
                const response = await fetch('/users/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                if (!response.ok) throw new Error('Login failed');
                const { token } = await response.json();
                localStorage.setItem('token', token);
                alert('Login successful!');
            } catch (error) {
                alert(error.message);
            }
        });

        async function handlePayment() {
            const amount = calculateTotalAmount(); // Implement this function to calculate the total amount
            try {
                const response = await fetch('/payments/create-payment-intent', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount })
                });
                if (!response.ok) throw new Error('Payment failed');
                const { clientSecret } = await response.json();
                const stripe = Stripe('your_stripe_public_key');
                const { error } = await stripe.confirmCardPayment(clientSecret, {
                    payment_method: {
                        card: elements.getElement(CardElement), // Implement Stripe Elements
                        billing_details: { name: 'Customer Name' }
                    }
                });
                if (error) throw new Error(error.message);
                alert('Payment successful!');
            } catch (error) {
                alert(error.message);
            }
        }
    </script>
</body>
</html>
